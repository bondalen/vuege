# Terminal MCP Server - Установка и настройка

## Описание
Terminal MCP Server предоставляет безопасный доступ к терминальным командам в Cursor IDE через Model Context Protocol (MCP). Решает проблему [P250816-01] с установкой терминального доступа.

## Установленные компоненты

### 1. Terminal MCP Server
- **Пакет**: `@rinardnick/mcp-terminal` (npm)
- **Установка**: `npm install -g @rinardnick/mcp-terminal`
- **Путь**: `/home/alex/.npm-global/bin/mcp-terminal`
- **Обертка**: `/home/alex/vuege/src/infrastructure/scripts/mcp-terminal-wrapper.py`
- **Версия**: Последняя стабильная

### 2. Конфигурация MCP
- **Файл**: `~/.cursor/mcp.json`
- **Сервер**: `terminal-mcp`
- **Безопасность**: Ограничения на разрешенные команды

## Настройка безопасности

### Безопасность
Сервер `@rinardnick/mcp-terminal` предоставляет безопасный доступ к терминальным командам:

- **Встроенная безопасность**: Валидация команд на уровне сервера
- **Ограничения**: Поддержка `--allowed-commands` для ограничения доступных команд
- **Мониторинг**: Логирование всех выполняемых команд
- **Изоляция**: Выполнение в контролируемой среде
- **Таймауты**: Автоматическое завершение длительных команд

### Команды по категориям

#### Разработка
- `python` - выполнение Python скриптов
- `pip` - управление Python пакетами
- `git` - операции с Git

#### Файловая система
- `ls` - просмотр содержимого директорий
- `cd` - смена директории
- `pwd` - текущий путь
- `find` - поиск файлов

#### Просмотр файлов
- `cat` - просмотр содержимого файлов
- `head` - начало файла
- `tail` - конец файла
- `grep` - поиск в файлах

#### Системная информация
- `ps` - процессы
- `top` - мониторинг системы
- `df` - использование дисков
- `du` - размер директорий

## Тестирование

### Проверка установки
```bash
which mcp-terminal
# Должен вернуть: /home/alex/.npm-global/bin/mcp-terminal
```

### Тест MCP протокола
```bash
source venv/bin/activate
echo '{"jsonrpc": "2.0", "id": 1, "method": "initialize", "params": {"protocolVersion": "2024-11-05", "capabilities": {}, "clientInfo": {"name": "test", "version": "1.0.0"}}}' | python src/infrastructure/scripts/mcp-terminal-wrapper.py
```

### Ожидаемый ответ
```json
{
  "result": {
    "protocolVersion": "2024-11-05",
    "capabilities": {"tools": {}},
    "serverInfo": {"name": "terminal", "version": "1.0.0"}
  },
  "jsonrpc": "2.0",
  "id": 1
}
```

## Использование в Cursor

### Автоматическое подключение
1. Перезапустите Cursor IDE
2. Terminal MCP Server автоматически подключится
3. Проверьте наличие зеленой точки в панели MCP Tools

### Выполнение команд
- Используйте естественный язык для описания команд
- Сервер автоматически выберет подходящую команду
- Результаты отображаются в чате

### Примеры использования
- "Покажи содержимое текущей директории"
- "Найди все Python файлы в проекте"
- "Проверь статус Git репозитория"
- "Установи пакет requests через pip"

## Устранение проблем

### Проблема: Terminal MCP Server не появляется в Cursor

**Возможные причины и решения:**

1. **Неправильный путь к исполняемому файлу**
   ```bash
   # Проверьте путь
   which mcp-terminal
   
   # Обновите конфигурацию если нужно
   # ~/.cursor/mcp.json
   ```

2. **Проблемы с правами доступа**
   ```bash
   # Проверьте права
   ls -la /home/alex/.npm-global/bin/mcp-terminal
   ls -la /home/alex/vuege/src/infrastructure/scripts/mcp-terminal-wrapper.py
   
   # Установите права если нужно
   chmod +x /home/alex/vuege/src/infrastructure/scripts/mcp-terminal-wrapper.py
   ```

3. **Проблемы с конфигурацией**
   - Проверьте синтаксис JSON в `~/.cursor/mcp.json`
   - Убедитесь в правильности аргументов
   - Проверьте логи Cursor

4. **Перезапуск Cursor**
   - Полностью закройте Cursor
   - Удалите временные файлы: `rm -rf ~/.cursor/logs/*`
   - Запустите Cursor заново

### Проблема: Команды не выполняются

1. **Проверьте список разрешенных команд**
   - Убедитесь, что нужная команда в списке `--allowed-commands`
   - Добавьте команду в конфигурацию при необходимости

2. **Проверьте права пользователя**
   - Некоторые команды требуют sudo
   - Убедитесь в наличии необходимых прав

## Безопасность

### Принципы безопасности
1. **Ограничение команд** - только разрешенные команды
2. **Предотвращение инъекций** - валидация входных данных
3. **Мониторинг** - отслеживание выполняемых команд
4. **Обновления** - регулярное обновление пакета

### Рекомендации
- Регулярно обновляйте список разрешенных команд
- Мониторьте логи выполнения
- Не добавляйте опасные команды (rm -rf, sudo, etc.)
- Используйте минимально необходимые права

## Обновления

### Обновление пакета
```bash
npm update -g @rinardnick/mcp-terminal
```

### Проверка версии
```bash
mcp-terminal --version
```

## Связанные документы
- `docs/main/problems.md` - проблема [P250816-01]
- `docs/main/changelog.md` - история изменений
- `docs/main/project.md` - архитектура проекта
- `~/.cursor/mcp.json` - конфигурация MCP

## Статус
- ✅ **Установлено**: Terminal MCP Server
- ✅ **Настроено**: Конфигурация безопасности
- ✅ **Протестировано**: Работа с MCP протоколом
- ⚠️ **Интеграция с Cursor**: Требует дальнейшего решения
- ✅ **Документировано**: Полная документация

## Известные проблемы

### Проблема: Сервер не появляется в Cursor IDE
**Описание**: После настройки конфигурации сервер не отображается в панели MCP Tools Cursor IDE.

**Возможные причины**:
1. Проблемы с интеграцией npm пакетов в Cursor
2. Неправильные пути к исполняемым файлам
3. Проблемы с правами доступа
4. Конфликты с другими MCP серверами

**Планы решения**:
1. Диагностика проблем интеграции
2. Тестирование альтернативных подходов
3. Исследование совместимости с Cursor IDE

