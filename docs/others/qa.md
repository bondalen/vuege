# Проблемы и решения проекта Vuege

## Порядок формирования записи в файле

Каждая запись о проблеме должна содержать:
1. **Идентификатор проблемы** (формат: PYYMMDD-NN)
2. **Название проблемы**
3. **Описание симптомов**
4. **Причина проблемы**
5. **Способы решения** (пронумерованные)
6. **Статус решения**
7. **Дата создания/решения**

---

## P250825-01: Проблема блокировки терминала из-за pager

**Описание**: При выполнении git команд терминал блокируется из-за pager
**Симптомы**: Команды git status, git log останавливаются и ждут ввода
**Причина**: Настройки pager в git и переменная окружения PAGER
**Статус**: ✅ Решено
**Дата**: 25 августа 2025

### Способы решения:
1.1. **Приоритетная настройка**: `./src/infrastructure/scripts/robust-pager-protection.sh`
1.2. **Альтернативная настройка**: `./src/infrastructure/scripts/setup-pager-protection.sh`
1.3. **Ручная настройка**: `export PAGER=cat && git config --global core.pager cat`

---

## P250825-02: Неправильная кнопка при редактировании в форме "Государства"

**Описание**: При редактировании записи в форме показывается кнопка "СОЗДАТЬ" вместо "СОХРАНИТЬ"
**Симптомы**: 
- Диалог редактирования открывается с предзаполненными данными
- Кнопка остается "СОЗДАТЬ" вместо "СОХРАНИТЬ"
- При нажатии создается новая запись вместо обновления существующей
**Причина**: Неправильный порядок операций в функции `editState()` - сначала устанавливался `editingState.value = state`, затем вызывался `resetForm()`, который сбрасывал `editingState.value = null`
**Статус**: ✅ Решено
**Дата**: 25 августа 2025

### Способы решения:
2.1. **Изменение порядка операций в editState()**:
   ```javascript
   const editState = (state: any) => {
     // 1. Сначала сбрасываем форму
     resetForm()
     
     // 2. Затем устанавливаем режим редактирования
     editingState.value = state
     
     // 3. Заполняем форму данными
     form.name = state.name
     // ... остальные поля
   }
   ```

---

## P250825-03: Удаление без подтверждения в форме "Государства"

**Описание**: При нажатии кнопки удаления запись удаляется сразу, не дожидаясь подтверждения пользователя
**Симптомы**:
- Диалог подтверждения и сообщение об успешном удалении появляются одновременно
- Кнопка "Отмена" не предотвращает удаление
- Удаление происходит до ответа пользователя
**Причина**: `$q.dialog` не ждал ответа пользователя, возвращая `true` по умолчанию
**Статус**: ✅ Решено
**Дата**: 25 августа 2025

### Способы решения:
3.1. **Использование Promise с обработчиками событий**:
   ```javascript
   const confirmed = await new Promise((resolve) => {
     $q.dialog({
       title: 'Подтверждение удаления',
       message: `Вы уверены, что хотите удалить организацию "${state.name}"?`,
       ok: { label: 'Удалить', color: 'negative' },
       cancel: { label: 'Отмена', color: 'primary' },
       persistent: true
     }).onOk(() => {
       console.log('✅ Пользователь нажал "Удалить"')
       resolve(true)
     }).onCancel(() => {
       console.log('❌ Пользователь нажал "Отмена"')
       resolve(false)
     }).onDismiss(() => {
       console.log('❌ Диалог закрыт без ответа')
       resolve(false)
     })
   })
   ```

---

## P250825-04: Отсутствие поля исторического периода в форме "Государства"

**Описание**: В форме создания/редактирования отсутствует поле для выбора исторического периода
**Симптомы**:
- Форма не содержит поле "Исторический период"
- Данные о периоде не сохраняются при создании/редактировании
- Отсутствует связь с таблицей исторических периодов
**Причина**: Поле не было добавлено в форму и не обрабатывалось в логике
**Статус**: ✅ Решено
**Дата**: 25 августа 2025

### Способы решения:
4.1. **Добавление поля в форму**:
   ```html
   <select v-model="form.historicalPeriodId" aria-label="Исторический период">
     <option value="1">Раннее Средневековье (476-1000)</option>
     <option value="2">Высокое Средневековье (1000-1300)</option>
     <option value="3">Позднее Средневековье (1300-1492)</option>
     <option value="4">Новое время (1492-1789)</option>
     <option value="5">Новейшее время (1789-2025)</option>
   </select>
   ```

4.2. **Автоматическое определение периода на основе даты основания**:
   ```javascript
   const foundedYear = parseInt(state.foundedDate?.substring(0, 4) || '1000');
   if (foundedYear < 1000) {
     form.historicalPeriodId = '1'; // Раннее Средневековье
   } else if (foundedYear < 1300) {
     form.historicalPeriodId = '2'; // Высокое Средневековье
   } else if (foundedYear < 1492) {
     form.historicalPeriodId = '3'; // Позднее Средневековье
   } else if (foundedYear < 1789) {
     form.historicalPeriodId = '4'; // Новое время
   } else {
     form.historicalPeriodId = '5'; // Новейшее время
   }
   ```

---

## P250825-05: Цикл чтения файлов в AI ассистенте

**Описание**: AI ассистент застревает в цикле чтения файлов, не завершая операции
**Симптомы**: Бесконечное чтение файлов без завершения задач
**Причина**: Проблема в логике обработки файлов в AI ассистенте
**Статус**: ⚠️ Актуальна
**Дата**: 25 августа 2025

### Способы решения:
5.1. **Использование desktop-commander-mcp** для операций с файлами
5.2. **Ограничение количества операций чтения** в одной сессии
5.3. **Принудительное завершение** длительных операций

---