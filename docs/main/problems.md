# Долговременные проблемы проекта Vuege

**Псевдонимы**: файл проблем

Этот файл содержит учет проблем, которые не удалось решить в рамках одного чата и требуют долгосрочного решения.

## Порядок формирования записи в файле

### Система нумерации
Проблемы нумеруются по шаблону: **PYYMMDD-NN**
- **P** - префикс для обозначения проблемы (Problem)
- **YYMMDD** - дата выявления проблемы (год-месяц-день)
- **NN** - порядковый номер проблемы в течение дня (01, 02, 03...)

### Статусы проблем
- **Актуальна** - проблема требует решения
- **Решена** - проблема решена, но может повториться
- **Потеряла актуальность** - проблема больше не актуальна

### Приоритеты проблем
- **Критический** - блокирует работу проекта
- **Высокий** - существенно влияет на работу
- **Средний** - влияет на эффективность
- **Низкий** - не критично, но желательно решить

### Структура записи проблемы
```
## [PYYMMDD-NN] - Краткое описание проблемы

**Статус**: [Актуальна/Решена/Потеряла актуальность]
**Дата выявления**: YYYY-MM-DD
**Приоритет**: [Критический/Высокий/Средний/Низкий]

### Описание
Детальное описание проблемы и ее влияния на проект.

### Полезные ссылки
- Ссылки на альтернативные решения и ресурсы
- Ссылки на документацию и примеры
- Ссылки на связанные проекты и инструменты

### История решения
#### Чат N: [Название чата или "Чат не известен"]
##### Попытка N (YYYY-MM-DD)
**Действия**: Описание предпринятых действий
**Результат**: Полученные результаты
**Причина неудачи**: Анализ причин неудачи

### Инциденты
#### Инцидент N (YYYY-MM-DD)
```

---

## Актуальные проблемы

## [P250817-02] - Проблема блокировки терминала из-за "проблемы pager"

**Статус**: Актуальна
**Дата выявления**: 2025-08-17
**Приоритет**: Критический

### Описание
При выполнении команд git в терминале происходит блокировка из-за активации pager (less/more). Это критически блокирует работу с проектом.

### Полезные ссылки
- [Git Pager Configuration](https://git-scm.com/book/en/v2/Customizing-Git-Git-Configuration#_core_pager)
- [Desktop Commander MCP](https://github.com/desktop-commander/desktop-commander-mcp)
- [Robust Pager Protection Script](./robust-pager-protection.sh)

### История решения
#### Чат 1: "ЭТАП 10: ФИНАЛЬНОЕ ТЕСТИРОВАНИЕ И РАЗВЕРТЫВАНИЕ VUEGE"
##### Попытка 1 (2025-08-27)
**Действия**: Создан защитный скрипт robust-pager-protection.sh, настроены алиасы git
**Результат**: Проблема частично решена, но требует постоянного внимания
**Причина неудачи**: Проблема системного уровня, требует постоянной профилактики

### Инциденты
#### Инцидент 1 (2025-08-17)
Блокировка терминала при выполнении `git status` без флага `--porcelain`

---

## [P250825-01] - Проблема цикла чтения файлов в AI ассистенте

**Статус**: Актуальна
**Дата выявления**: 2025-08-25
**Приоритет**: Средний

### Описание
При работе с AI ассистентом происходит цикл чтения файлов, что приводит к неэффективности и потенциальным блокировкам.

### Полезные ссылки
- [Cursor IDE Documentation](https://cursor.sh/docs)
- [AI Assistant Best Practices](https://docs.cursor.sh/ai/chat)

### История решения
#### Чат 1: "ЭТАП 10: ФИНАЛЬНОЕ ТЕСТИРОВАНИЕ И РАЗВЕРТЫВАНИЕ VUEGE"
##### Попытка 1 (2025-08-27)
**Действия**: Использование desktop-commander-mcp для безопасной работы с файлами
**Результат**: Проблема частично решена
**Причина неудачи**: Проблема архитектурного уровня AI ассистента

---

## [P250827-01] - Проблема GraphQL мутаций в VUEGE

**Статус**: Актуальна
**Дата выявления**: 2025-08-27
**Приоритет**: Средний

### Описание
GraphQL мутации (CREATE, UPDATE, DELETE) возвращают INTERNAL_ERROR, что ограничивает функциональность системы. READ операции работают идеально.

### Полезные ссылки
- [Spring GraphQL Documentation](https://docs.spring.io/spring-graphql/docs/current/reference/html/)
- [GraphQL Mutations Best Practices](https://graphql.org/learn/queries/#mutations)
- [Spring Boot Validation](https://spring.io/guides/gs/validating-form-input/)

### История решения
#### Чат 1: "ЭТАП 10: ФИНАЛЬНОЕ ТЕСТИРОВАНИЕ И РАЗВЕРТЫВАНИЕ VUEGE"
##### Попытка 1 (2025-08-27)
**Действия**: CRUD тестирование выявило проблему с мутациями
**Результат**: Проблема идентифицирована, требуется доработка Backend
**Причина неудачи**: Недостаточная валидация и обработка ошибок в GraphQL контроллерах

### Инциденты
#### Инцидент 1 (2025-08-27)
Ошибка `INTERNAL ERROR for 44f6280c-1931-4c0c-113f-10c4e31034d4` при создании организационной единицы

---

## Решенные проблемы

## [P250817-01] - Проблема с Liquibase миграциями

**Статус**: Решена
**Дата выявления**: 2025-08-17
**Дата решения**: 2025-08-17
**Приоритет**: Критический

### Описание
Проблемы с выполнением Liquibase миграций при запуске Spring Boot приложения.

### История решения
#### Чат 1: "ЭТАП 2: Полное исправление Liquibase"
##### Попытка 1 (2025-08-17)
**Действия**: Исправлены SQL скрипты, добавлены недостающие поля, исправлена структура таблиц
**Результат**: Миграции выполняются успешно
**Статус**: Решена

---

## [P250825-02] - Проблема отображения опций в q-select компоненте

**Статус**: Решена
**Дата выявления**: 2025-08-25
**Дата решения**: 2025-08-27
**Приоритет**: Высокий

### Описание
В компоненте StatesPage.vue выпадающий список "Тип государства" (q-select) не отображал все доступные опции. При открытии выпадающего списка показывалась только одна опция (текущее выбранное значение) вместо всех 4 опций из массива stateTypes.

### Полезные ссылки
- [Quasar q-select Documentation](https://quasar.dev/vue-components/select)
- [Vue 3 Reactivity](https://vuejs.org/guide/extras/reactivity-in-depth.html)
- [Quasar Virtual Scrolling](https://quasar.dev/vue-components/select#virtual-scrolling)

### История решения
#### Чат 1: "ЭТАП 10: ФИНАЛЬНОЕ ТЕСТИРОВАНИЕ И РАЗВЕРТЫВАНИЕ VUEGE"
##### Попытка 1 (2025-08-27)
**Действия**: Добавлены параметры option-value="value", option-label="label", emit-value, map-options
**Результат**: Проблема не решена
**Причина неудачи**: Неправильная структура данных

##### Попытка 2 (2025-08-27)
**Действия**: Сделан массив stateTypes реактивным (ref())
**Результат**: Проблема не решена
**Причина неудачи**: Проблема не в реактивности

##### Попытка 3 (2025-08-27)
**Действия**: Использован computed для stateTypes, исправлены функции getStateTypeLabel и editState
**Результат**: Проблема решена
**Статус**: Решена

### Техническое решение
1. **Использован computed для stateTypes**:
   ```javascript
   const stateTypes = computed(() => [
     { label: 'Государство', value: 'STATE' },
     { label: 'Правительство', value: 'GOVERNMENT' },
     { label: 'Коммерческая', value: 'COMMERCIAL' },
     { label: 'Империя', value: 'EMPIRE' }
   ])
   ```

2. **Правильно настроены параметры q-select**:
   ```html
   <q-select
     v-model="form.type"
     :options="stateTypes"
     label="Тип государства"
     outlined
     dense
     class="q-mb-md"
     option-value="value"
     option-label="label"
     emit-value
     map-options
     clearable
   />
   ```

3. **Исправлены функции**:
   - `getStateTypeLabel` - использует `stateTypes.value`
   - `editState` - использует `stateTypes.value`

### Созданные тестовые страницы
- `/minimal-test` - минимальный тест q-select
- `/force-render-test` - тест принудительного рендеринга
- `/virtual-scroll-test` - тест отключения виртуального скроллинга
- `/string-test` - тест со строками
- `/qselect-test` - комплексный тест различных конфигураций

### Инциденты
#### Инцидент 1 (2025-08-27)
q-select отображал только одну опцию вместо всех четырех в выпадающем списке

---

## [P250825-03] - Неправильная кнопка при редактировании в форме "Государства"

**Статус**: Решена
**Дата выявления**: 2025-08-25
**Дата решения**: 2025-08-25
**Приоритет**: Высокий

### Описание
При редактировании записи в форме "Государства" показывалась кнопка "СОЗДАТЬ" вместо "СОХРАНИТЬ". Это приводило к созданию новой записи вместо обновления существующей.

### Полезные ссылки
- [Vue 3 Composition API](https://vuejs.org/guide/extras/composition-api-faq.html)
- [Quasar Dialog Documentation](https://quasar.dev/vue-components/dialog)

### История решения
#### Чат 1: "CRUD операции страницы 'Государства'"
##### Попытка 1 (2025-08-25)
**Действия**: Изменен порядок операций в функции editState() - сначала resetForm(), затем editingState.value = state
**Результат**: Проблема решена
**Статус**: Решена

### Техническое решение
```javascript
const editState = (state: any) => {
  // 1. Сначала сбрасываем форму
  resetForm()
  
  // 2. Затем устанавливаем режим редактирования
  editingState.value = state
  
  // 3. Заполняем форму данными
  form.name = state.name
  // ... остальные поля
}
```

### Инциденты
#### Инцидент 1 (2025-08-25)
При редактировании записи "Византийская империя" показывалась кнопка "СОЗДАТЬ" вместо "СОХРАНИТЬ"

---

## [P250825-04] - Удаление без подтверждения в форме "Государства"

**Статус**: Решена
**Дата выявления**: 2025-08-25
**Дата решения**: 2025-08-25
**Приоритет**: Критический

### Описание
При нажатии кнопки удаления запись удалялась сразу, не дожидаясь подтверждения пользователя. Диалог подтверждения и сообщение об успешном удалении появлялись одновременно.

### Полезные ссылки
- [Quasar Dialog API](https://quasar.dev/vue-components/dialog#api)
- [Vue 3 Async/Await](https://vuejs.org/guide/best-practices/async-await.html)

### История решения
#### Чат 1: "CRUD операции страницы 'Государства'"
##### Попытка 1 (2025-08-25)
**Действия**: Использование Promise с обработчиками событий .onOk(), .onCancel(), .onDismiss()
**Результат**: Проблема решена
**Статус**: Решена

### Техническое решение
```javascript
const confirmed = await new Promise((resolve) => {
  $q.dialog({
    title: 'Подтверждение удаления',
    message: `Вы уверены, что хотите удалить организацию "${state.name}"?`,
    ok: { label: 'Удалить', color: 'negative' },
    cancel: { label: 'Отмена', color: 'primary' },
    persistent: true
  }).onOk(() => {
    console.log('✅ Пользователь нажал "Удалить"')
    resolve(true)
  }).onCancel(() => {
    console.log('❌ Пользователь нажал "Отмена"')
    resolve(false)
  }).onDismiss(() => {
    console.log('❌ Диалог закрыт без ответа')
    resolve(false)
  })
})
```

### Инциденты
#### Инцидент 1 (2025-08-25)
Удаление записи "Тестовая организация" происходило без подтверждения пользователя

---

## [P250825-05] - Отсутствие поля исторического периода в форме "Государства"

**Статус**: Решена
**Дата выявления**: 2025-08-25
**Дата решения**: 2025-08-25
**Приоритет**: Средний

### Описание
В форме создания/редактирования отсутствовало поле для выбора исторического периода. Данные о периоде не сохранялись при создании/редактировании записей.

### Полезные ссылки
- [HTML Select Element](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/select)
- [Vue 3 Form Handling](https://vuejs.org/guide/essentials/forms.html)

### История решения
#### Чат 1: "CRUD операции страницы 'Государства'"
##### Попытка 1 (2025-08-25)
**Действия**: Добавлен select с историческими периодами и автоматическое определение периода на основе даты основания
**Результат**: Проблема решена
**Статус**: Решена

### Техническое решение
1. **Добавление поля в форму**:
   ```html
   <select v-model="form.historicalPeriodId" aria-label="Исторический период">
     <option value="1">Раннее Средневековье (476-1000)</option>
     <option value="2">Высокое Средневековье (1000-1300)</option>
     <option value="3">Позднее Средневековье (1300-1492)</option>
     <option value="4">Новое время (1492-1789)</option>
     <option value="5">Новейшее время (1789-2025)</option>
   </select>
   ```

2. **Автоматическое определение периода**:
   ```javascript
   const foundedYear = parseInt(state.foundedDate?.substring(0, 4) || '1000');
   if (foundedYear < 1000) {
     form.historicalPeriodId = '1'; // Раннее Средневековье
   } else if (foundedYear < 1300) {
     form.historicalPeriodId = '2'; // Высокое Средневековье
   } else if (foundedYear < 1492) {
     form.historicalPeriodId = '3'; // Позднее Средневековье
   } else if (foundedYear < 1789) {
     form.historicalPeriodId = '4'; // Новое время
   } else {
     form.historicalPeriodId = '5'; // Новейшее время
   }
   ```

### Инциденты
#### Инцидент 1 (2025-08-25)
При создании записи "Византийская империя" не было возможности указать исторический период

---

## [P250828-01] - Общие проблемы CRUD операций на страницах сущностей

**Статус**: Актуальна
**Дата выявления**: 2025-08-28
**Приоритет**: Высокий

### Описание
Типичные проблемы, возникающие при реализации CRUD операций на страницах сущностей в Vue.js приложениях с Quasar Framework. Эти проблемы могут повторяться на разных страницах и требуют системного подхода к решению.

### Категории проблем

#### 1. **Проблемы отображения данных**
- Неправильное отображение опций в выпадающих списках
- Проблемы с реактивностью данных
- Ошибки в структуре таблиц и форм

#### 2. **Проблемы режимов работы форм**
- Неправильное различение режимов создания и редактирования
- Неправильные кнопки в диалогах (Создать/Сохранить)
- Проблемы с инициализацией данных формы

#### 3. **Проблемы подтверждения операций**
- Отсутствие подтверждения для критических операций
- Неправильная работа диалогов подтверждения
- Удаление без ожидания ответа пользователя

#### 4. **Проблемы валидации**
- Отсутствие валидации обязательных полей
- Неправильная обработка ошибок валидации
- Отсутствие обратной связи пользователю

#### 5. **Проблемы интеграции с Backend**
- Ошибки в GraphQL мутациях
- Проблемы с обработкой ответов API
- Отсутствие обработки ошибок сети

### Полезные ссылки
- [Vue 3 Composition API](https://vuejs.org/guide/extras/composition-api-faq.html)
- [Quasar Framework Documentation](https://quasar.dev/)
- [GraphQL Best Practices](https://graphql.org/learn/best-practices/)
- [Vue 3 Form Validation](https://vuejs.org/guide/essentials/forms.html#validation)

### Частные случаи (решенные проблемы)

#### P250825-02: Проблема отображения опций в q-select компоненте
- **Симптом**: q-select отображал только одну опцию вместо всех
- **Решение**: Использование computed для stateTypes, правильная настройка параметров

#### P250825-03: Неправильная кнопка при редактировании
- **Симптом**: При редактировании показывалась кнопка "СОЗДАТЬ" вместо "СОХРАНИТЬ"
- **Решение**: Правильный порядок операций в editState()

#### P250825-04: Удаление без подтверждения
- **Симптом**: Удаление происходило сразу, не дожидаясь ответа пользователя
- **Решение**: Promise с обработчиками событий для диалога

#### P250825-05: Отсутствие поля исторического периода
- **Симптом**: В форме не было поля для выбора исторического периода
- **Решение**: Добавление select с автоматическим определением периода

### Чек-лист для проверки новых страниц

#### ✅ Отображение данных
- [ ] Выпадающие списки отображают все опции
- [ ] Таблицы корректно отображают данные
- [ ] Реактивность данных работает правильно

#### ✅ Режимы работы форм
- [ ] Правильное различение создания и редактирования
- [ ] Корректные кнопки в диалогах
- [ ] Правильная инициализация данных формы

#### ✅ Подтверждение операций
- [ ] Критические операции требуют подтверждения
- [ ] Диалоги подтверждения работают корректно
- [ ] Удаление ждет ответа пользователя

#### ✅ Валидация
- [ ] Обязательные поля проверяются
- [ ] Ошибки валидации отображаются пользователю
- [ ] Форма не отправляется при ошибках

#### ✅ Интеграция с Backend
- [ ] GraphQL мутации работают корректно
- [ ] Ошибки API обрабатываются
- [ ] Состояние загрузки отображается

### Технические решения (шаблоны)

#### 1. **Правильная настройка q-select**
```javascript
const options = computed(() => [
  { label: 'Опция 1', value: 'VALUE1' },
  { label: 'Опция 2', value: 'VALUE2' }
])

<q-select
  v-model="form.field"
  :options="options"
  option-value="value"
  option-label="label"
  emit-value
  map-options
/>
```

#### 2. **Правильный порядок операций редактирования**
```javascript
const editItem = (item: any) => {
  resetForm()           // 1. Сброс формы
  editingItem.value = item  // 2. Установка режима
  // Заполнение формы   // 3. Заполнение данными
}
```

#### 3. **Подтверждение критических операций**
```javascript
const confirmed = await new Promise((resolve) => {
  $q.dialog({...})
    .onOk(() => resolve(true))
    .onCancel(() => resolve(false))
    .onDismiss(() => resolve(false))
})
```

#### 4. **Валидация обязательных полей**
```javascript
const saveItem = async () => {
  if (!form.name.trim()) {
    $q.notify({
      type: 'negative',
      message: 'Название обязательно для заполнения'
    })
    return
  }
  // Сохранение
}
```

### История решения
#### Чат 1: "CRUD операции страницы 'Государства'"
##### Попытка 1 (2025-08-25)
**Действия**: Выявлены и решены 4 частные проблемы CRUD операций
**Результат**: Создан чек-лист и технические решения для предотвращения повторения
**Статус**: Актуальна (требует проверки на других страницах)

### Инциденты
#### Инцидент 1 (2025-08-25)
Выявлены 4 критические проблемы на странице "Государства", требующие системного решения

---

## Проблемы, потерявшие актуальность

## [P250817-03] - Проблема с Node.js версией

**Статус**: Потеряла актуальность
**Дата выявления**: 2025-08-17
**Дата закрытия**: 2025-08-17
**Приоритет**: Средний

### Описание
Устаревшая версия Node.js в проекте.

### История решения
#### Чат 1: "ЭТАП 3: Обновление Node.js"
##### Попытка 1 (2025-08-17)
**Действия**: Обновлен Node.js до версии 20+
**Результат**: Проблема решена
**Статус**: Потеряла актуальность