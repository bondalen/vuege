#!/bin/bash

# @file: start-postgres-mcp.sh
# @description: –ó–∞–ø—É—Å–∫ PostgreSQL MCP —Å–µ—Ä–≤–µ—Ä–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç pager
# @pager-protection: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç pager –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
# @dependencies: postgres-mcp, docker
# @created: 2025-08-20

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç pager
export PAGER=cat
export LESS="-R -M --shift 5"
export MORE="-R"
export COMPOSER_NO_INTERACTION=1
export TERM=xterm-256color
export COLUMNS=120
export LINES=30
export GIT_PAGER=cat
export GIT_EDITOR=vim

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ git pager –≥–ª–æ–±–∞–ª—å–Ω–æ
git config --global core.pager cat 2>/dev/null

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
source venv/bin/activate

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ -f .env ]; then
    export $(cat .env | grep -v '^#' | xargs)
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ PostgreSQL
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ PostgreSQL..."
if ! timeout 5s docker ps | grep -q postgres; then
    echo "‚ùå PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    echo "üí° –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: docker start postgres-java-universal"
    exit 1
fi

echo "‚úÖ PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω"

# –ó–∞–ø—É—Å–∫ PostgreSQL MCP Server
echo "üöÄ –ó–∞–ø—É—Å–∫ PostgreSQL MCP Server..."
export PGPASSWORD=testpass
exec venv/bin/python src/infrastructure/scripts/postgres-mcp-wrapper.py



